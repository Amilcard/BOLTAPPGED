{
  "probleme": "Régressions visuelles systématiques à chaque npm run dev",
  "symptomes": [
    "Styles Tailwind non appliqués",
    "Fonts perdues (Rubik non chargée)",
    "Header layout cassé",
    "Liens redevenus natifs (underline bleu)",
    "Containers max-width non respectés"
  ],

  "audit_complet": {
    "globals_css": "✅ CORRECT - @tailwind présents + CSS vars OK",
    "layout_tsx": "✅ CORRECT - import './globals.css' ligne 3",
    "tailwind_config": "✅ CORRECT - content paths valides",
    "font_rubik": "✅ CORRECT - Next font configuré",
    "wrapper_structure": "✅ CORRECT - min-h-screen + containers présents"
  },

  "causes_identifiees": {
    "cause_1_hot_reload": {
      "description": "Next.js 14 hot-reload parfois incomplet en dev",
      "symptome": "CSS compilé mais non injecté dans le DOM",
      "verification": "Inspecter element → classes Tailwind présentes mais non stylées",
      "solution": "Hard refresh (Ctrl+Shift+R) ou redémarrer serveur"
    },

    "cause_2_css_cache": {
      "description": "Cache Tailwind JIT (.next/cache) corrompu",
      "symptome": "Classes détectées par config mais non générées",
      "solution": "rm -rf .next && npm run dev"
    },

    "cause_3_output_standalone": {
      "description": "next.config.js L4: output: 'standalone' peut causer bugs en dev",
      "fichier": "next.config.js",
      "ligne": 4,
      "config_actuelle": "output: process.env.NEXT_OUTPUT_MODE || 'standalone'",
      "probleme": "Mode standalone = optimisé pour production Docker, pas dev",
      "fix": "Supprimer cette ligne OU conditionner: output: process.env.NODE_ENV === 'production' ? 'standalone' : undefined"
    },

    "cause_4_dist_dir_custom": {
      "description": "next.config.js L3: distDir custom peut causer cache issues",
      "fichier": "next.config.js",
      "ligne": 3,
      "config_actuelle": "distDir: process.env.NEXT_DIST_DIR || '.next'",
      "recommandation": "Laisser Next.js utiliser .next par défaut en dev"
    },

    "cause_5_font_flash": {
      "description": "Font Rubik chargée en 'swap' → FOUT (Flash of Unstyled Text)",
      "fichier": "app/layout.tsx",
      "ligne": 10,
      "config": "display: 'swap'",
      "effet": "Texte s'affiche d'abord avec font système puis Rubik se charge",
      "non_critique": true
    }
  },

  "solutions_immediates": {
    "fix_1_hard_refresh": {
      "action": "Ctrl + Shift + R (ou Cmd + Shift + R sur Mac)",
      "quand": "À chaque démarrage npm run dev",
      "pourquoi": "Force rechargement CSS sans cache navigateur"
    },

    "fix_2_clean_cache": {
      "commandes": [
        "rm -rf .next",
        "rm -rf node_modules/.cache",
        "npm run dev"
      ],
      "quand": "Si hard refresh ne suffit pas",
      "duree": "~10 secondes"
    },

    "fix_3_next_config_dev_mode": {
      "fichier": "next.config.js",
      "modification": {
        "ligne_3_supprimer": "distDir: process.env.NEXT_DIST_DIR || '.next',",
        "ligne_4_remplacer": {
          "avant": "output: process.env.NEXT_OUTPUT_MODE || 'standalone',",
          "apres": "output: process.env.NODE_ENV === 'production' ? 'standalone' : undefined,"
        }
      },
      "explication": "Mode standalone uniquement en prod Docker, pas en dev"
    },

    "fix_4_vscode_settings": {
      "fichier": ".vscode/settings.json",
      "ajouter": {
        "tailwindCSS.experimental.classRegex": [
          ["cva\\(([^)]*)\\)", "[\"'`]([^\"'`]*).*?[\"'`]"],
          ["cn\\(([^)]*)\\)", "(?:'|\"|`)([^']*)(?:'|\"|`)"]
        ],
        "tailwindCSS.validate": true,
        "css.validate": false
      },
      "explication": "Améliore détection Tailwind par VSCode"
    }
  },

  "fix_definitif_recommande": {
    "etape_1": "Modifier next.config.js",
    "code": "const nextConfig = {\n  // distDir: SUPPRIMÉ (utiliser .next par défaut)\n  output: process.env.NODE_ENV === 'production' ? 'standalone' : undefined,\n  experimental: {\n    outputFileTracingRoot: path.join(__dirname),\n  },\n  // ... reste inchangé\n};",
    "etape_2": "Clean build",
    "commandes": [
      "rm -rf .next",
      "npm run dev"
    ],
    "etape_3": "Hard refresh navigateur (Ctrl+Shift+R)",
    "resultat_attendu": "CSS stable à chaque reload"
  },

  "workflow_dev_optimal": {
    "demarrage": [
      "1. npm run dev",
      "2. Attendre 'compiled successfully'",
      "3. Ouvrir localhost:3000",
      "4. Hard refresh (Ctrl+Shift+R) UNE FOIS",
      "5. Travailler normalement"
    ],
    "si_styles_perdus": [
      "1. Ctrl+Shift+R dans navigateur",
      "2. Si persiste: Ctrl+C puis npm run dev",
      "3. Si persiste encore: rm -rf .next && npm run dev"
    ]
  },

  "verification_post_fix": {
    "inspect_element": "Classes Tailwind appliquées (ex: text-primary = #2a383f)",
    "network_tab": "Vérifier que /_next/static/css/*.css se charge",
    "console": "Aucune erreur 404 ou CORS",
    "fonts": "Rubik chargée (inspecter Computed dans DevTools)"
  },

  "statut": "DIAGNOSTIC COMPLET - 3 fixes proposés"
}
