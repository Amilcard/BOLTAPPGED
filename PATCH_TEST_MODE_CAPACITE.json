{
  "probleme": "Sessions à capacité <= 0 → CTA disabled → blocage tests/démo",
  "solution": "Mode TEST bypass capacité (backend + frontend)",

  "patch_1_backend_env": {
    "fichier": ".env",
    "action": "Ajouter ligne",
    "code": "NEXT_PUBLIC_TEST_MODE=true",
    "explication": "Flag public (NEXT_PUBLIC_) pour bypass côté client"
  },

  "patch_2_frontend_logic": {
    "fichier": "app/sejour/[id]/stay-detail.tsx",
    "lignes_concernees": [622, 628, 629, 651, 652, 732],

    "changement_L1_top_du_fichier": {
      "ajouter_apres_ligne_3": "const IS_TEST_MODE = process.env.NEXT_PUBLIC_TEST_MODE === 'true';"
    },

    "changement_L622": {
      "avant": "const isFull = (session?.seatsLeft ?? 0) === 0;",
      "apres": "const isFull = IS_TEST_MODE ? false : (session?.seatsLeft ?? 0) <= 0;"
    },

    "changement_L651_652": {
      "avant": "{isFull ? 'Complet' : `${session?.seatsLeft ?? 0} places`}",
      "apres": "{\n  isFull ? 'Complet' : \n  IS_TEST_MODE ? 'Test - illimité' : \n  (session?.seatsLeft === 1 ? '1 place' : `${session?.seatsLeft ?? 0} places`)\n}"
    },

    "changement_L732": {
      "avant": "disabled={!preSelectedSessionId || !preSelectedCity || sessions.filter(s => (s?.seatsLeft ?? 0) > 0).length === 0}",
      "apres": "disabled={!preSelectedSessionId || !preSelectedCity || (!IS_TEST_MODE && sessions.filter(s => (s?.seatsLeft ?? 0) > 0).length === 0)}"
    }
  },

  "comportement_test_mode": {
    "capacite_ignoree": true,
    "sessions_toujours_selectables": true,
    "cta_enabled_si": "session ET ville sélectionnées (capacité ignorée)",
    "badge_affiché": "'Test - illimité' au lieu de 'X places'"
  },

  "comportement_production": {
    "TEST_MODE": "false ou absent",
    "logique": "identique à l'actuel (capacité respectée)",
    "no_regression": true
  },

  "tokens_economises": "3 lignes code modifiées + 1 const + 1 var env = ~50 tokens",
  "impact": "0 régression prod, activation instantanée test"
}
